#summary Руководство по установке, конфигурации и тестированию под Windows
#labels Featured,Phase-Deploy

= Вступление =

Это - небольшое руководство по компиляции и установке Staff под Windows.

= Описание =

== 0. Переменные окружения ==
При компиляции, запуске Axis2/С, клиентского или сервисного приложения, должны быть установлены переменные окружения, указывающие на местоположение домашних каталогов Axis2/С и Staff:
{{{
AXIS2C_HOME=c:\ws\axis2c
STAFF_HOME=c:\ws\staff
PATH=%PATH%;%AXIS2C_HOME%/bin;%AXIS2C_HOME%/lib;%STAFF_HOME%/bin;%STAFF_HOME%/lib;<Путь к Postgresql>\bin;<Путь к Postgresql>\lib
}}}

Данные переменные окружения могут быть выставлены в свойствах системы.
После установки переменных, необходимо выполнить повторный вход в систему либо перезагрузку Windows.

== 1. Компиляция и установка зависимостей ==

Необходимо сначала установить Axis2/С-1.5.0.
Страница загрузки: http://ws.apache.org/Axis2/С/download.cgi

Распакуйте содержимое каталога axis2c-bin-1.5.0-win32 в каталог c:\ws\axis2c

Убедитесь, что сервер приложений Axis2/С стартует корректно, для этого запустите
{{{
c:\ws\axis2c\bin\axis2_http_server.exe
}}}

Должно появиться консольное окно с сообщением
{{{
Started Simple Axis2 HTTP Server ...
}}}
Если при запуске возникают ошибки, необходимо установить зависимости согласно инструкции по установке Axis2/С.

Убедитесь, что сервер приложений Axis2/С функционирует корректно, для этого откройте страницу
http://localhost:9090/axis2/services/
Должен отобразиться список сервисов Axis2/С.

== 2. Получение исходного кода Staff ==

Для получения информации о том, как получить исходный код из svn репозитория перейдите по ссылке http://code.google.com/p/staff/source/checkout.
Либо загрузите и распакуйте архив исходного кода из секции [http://code.google.com/p/staff/downloads/list Download].


== 3. Компиляция исходного кода ==

=== 3.1 Компиляция и установка rise ===

Откройте файл rise.vcproj в Visual studio 2005 из каталога rise.
Откомпилируйте библиотеку (меню Build -> Build Solution)
Скопируйте файлы Debug/rise.lib Debug/rise.dll в каталог c:\ws\staff\lib\
Скопируйте содержимое каталога staff\rise\rise\ в каталог c:\ws\staff\include\rise\ и в каталог staff\rise\deploy\win32\, исключая файлы cpp.

=== 3.2 Компиляция и установка Staff ===

Откройте файл staff.sln в Visual studio 2005 из каталога staff.
Отредактируйте пути включаемых файлов и пути библиотек к СУБД Postgres в свойствах проекта staff_security.
Откомпилируйте проектное решение (меню Build -> Build Solution)

Убедитесь что postgres установлен и запущен.
Запустите psql к posgres и введите следующие команды для установки БД.
{{{
\cd <полный путь к каталогу с исходными текстами>/staff/staff/core/security/
\i db/instdb.sql
}}}
Обратите внимание, в команде \cd разделители каталогов должны быть как в unix.

== 4. Конфигурация ==

=== 4.1 Конфигурация axis2 ===

Для добавления модулей staff в Axis2/С необходимо отредактировать конфигурационный файл:
{{{
%AXIS2C_HOME%\axis2.xml
}}}

следом за строкой:
{{{
<module ref="addressing"/>
}}}

добавьте:
{{{
<module ref="staff"/>
<module ref="staff_security"/>
}}}


=== 4.2 Конфигурация соединения с БД ===

Если необходимо изменить настройки соединения с БД отредактируйте файл:
{{{
%AXIS2C_HOME%\modules\staff_security\module.xml
}}}

Для изменения доступны следующие параметры:
{{{
<parameter name="pgHost" locked="false">localhost</parameter>
<parameter name="pgPort" locked="false">5432</parameter>
<parameter name="pgUser" locked="false">POSTGRES_USER</parameter>
<parameter name="pgPassword" locked="false">POSTGRES_PASSWORD</parameter>
}}}

Где POSTGRES_USER - Ваш пользователь БД(по умолчанию: staffdbuser), и POSTGRES_PASSWORD - пароль пользователя(по умолчанию: staffdbuserpassword).


== 5. Запуск ==

=== 5.1 Запуск в обычном режиме ===

Чтобы запустить сервер приложений Axis2/С в обычном режиме, введите команды:
{{{
cd %AXIS2C_HOME%\bin
axis2_http_server
}}}

=== 5.2 Запуск в отладочном режиме == 

Чтобы запустить сервер приложений Axis2/С в отладочном режиме, введите команды:
{{{
cd %AXIS2C_HOME%\bin
set RISE_LOG_LEVEL=DEBUG3
set RISE_EXCEPTION_STACKTRACING=1
axis2_http_server
}}}


== 6. Тестирование ==

=== 6.1 Основной тест ===

В Веб-браузере откройте ссылку:

http://localhost:9090/axis2/services

Сервисы "StaffService" и "staff.Login" должны быть в списке.

Примеры сервисов "calc.CalcService", "calc.SubService" должны быть в списке.


=== 6.2 Тест клиент-сервисного взаимодействия ===

Запустите сервис Calculator:
{{{
calculator_service
}}}

Из другой консоли запустите клиент calc:
{{{
calc_client
}}}
