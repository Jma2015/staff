#summary Пример: Создание J2ME клиента Calculator в Eclipse

<h1>Содержание</h1>
<wiki:toc max_depth="3" />

== Зависимости ==
Должны быть установлены следующие зависимости:
  * Java SE (JDK);
  * Sun Java Wireless Toolkit (WTK);
  * Eclipse с WTP, MTJ;
  * Сервис samples.Calculator из ExampleCalculatorServiceWindows или ExampleCalculatorServiceLinux;

== Создание J2ME клиента Calculator ==
=== Создание проекта ===
  # Запустите Eclipse и выберите "File" => "New" => "MIDlet Project";
  # Введите название проекта в поле "Project Name": Calculator;
  # Если список конфигураций пуст (группа "Configurations"), нажмите кнопку "Add...", выберите SDK, и Device, нажмите "Finish";
  # Нажмите "Finish"; будет открыт созданный проект;

=== Генерация прокси клиента ===
Скопируйте интерфейс сервиса samples.Calculator (Calculator.h) (из ExampleCalculatorServiceWindows или ExampleCalculatorServiceLinux) в каталог исходных файлов проекта.

Запустите генератор кода:
{{{
staff_codegen -tj2meclient Calculator.h
}}}

Прокси клиента будет сгенерирован в `samples/Calculator.java`.

=== Установка ksoap ===
Загрузите файл `ksoap2-j2me-core-2.1.2.jar` с http://sourceforge.net/projects/ksoap2/ и поместите его в каталог библиотек проекта `Calculator/lib`

=== Конфигурация проекта ===
  # В "Package exporer" выделите проект "Calculator" и обновите проект, нажав F5;
  # В "Package exporer" правой кнопкой по проекту, "Build Path" => "Configure Build Path...";
  # На вкладке "Libraries" нажмите "Add JARs...", и выберите Calculator/lib/ksoap2-j2me-core-2.1.2.jar, Нажмите "ОК";
  # На вкладке "Order and Export" поставьте флажок напротив пункта "ksoap2-j2me-core-2.1.2.jar - Calculator/lib", Нажмите "ОК";

=== Реализация мидлета ===
  # Создайте главный класс мидлета: правой кнопкой по имени проекта, "New" => "Java ME MIDlet";
  # В поле "Name:" введите название главного класса "CalculatorMIDlet", нажмите "Finish";
  # Eclipse сгенерирует исходный код мидлета. Вставьте исходный код мидлета, заменив сгенерированный:
{{{
import javax.microedition.lcdui.*;
import javax.microedition.midlet.*;

import samples.Calculator;

public class CalculatorMIDlet extends MIDlet implements CommandListener
{
  Form mainForm = new Form("Calculator");
  TextField tFieldA = new TextField("A=", "1", 5, TextField.NUMERIC);
  TextField tFieldB = new TextField("B=", "2", 5, TextField.NUMERIC);
  StringItem resultItem = new StringItem("Result", "");
  Command addCommand = new Command("Add", Command.SCREEN, 1);

  Calculator tCalcService = new Calculator();

  public CalculatorMIDlet()
  {
    mainForm.append(tFieldA);
    mainForm.append(tFieldB);
    mainForm.append(resultItem);
    mainForm.addCommand(addCommand);
    mainForm.setCommandListener(this);
  }

  public void startApp()
  {
    Display.getDisplay(this).setCurrent(mainForm);
  }

  public void pauseApp()
  {
  }

  public void destroyApp(boolean unconditional)
  {
  }

  public void commandAction(Command c, Displayable d)
  {
    if (c == addCommand)
    {
      new Thread()
      {
        public void run()
        {
          try
          {
            int nA = Integer.parseInt(tFieldA.getString());
            int nB = Integer.parseInt(tFieldB.getString());

            int nResult = tCalcService.Add(nA, nB);

            resultItem.setText(String.valueOf(nResult));
          }
          catch (Exception e)
          {
            e.printStackTrace();
            resultItem.setLabel("Error:");
            resultItem.setText(e.toString());
          }
        }
      }.start();
    }
  }
}
}}}


=== Компиляция и запуск ===
Компиляция проекта в Eclipse происходит автоматически.

Для запуска проекта нажмите Ctrl+F11 или Выберите из главного меню "Run" => "Run".

При необходимости создать jar-файл, правой кнопкой по проекту, "Mobile Tools for Java" => "Create Package".

== Тестирование ==
Когда окно эмулятора откроется, нажмите F2 для вызова операции "Add" в сервисе samples.Calculator.

Нажмите F2 для подтверждения доступа к сети (только один раз).

Результат будет выведен в поле "Result".

[http://staff.googlecode.com/svn/wiki/img/j2me-calculator.png http://staff.googlecode.com/svn/wiki/img/j2me-calculator.png]

== Загрузка ==

Загрузите исходный код [http://code.google.com/p/staff/downloads/detail?name=samples.Calculator-j2me-src.7z здесь]

Загрузите jar [http://code.google.com/p/staff/downloads/detail?name=samples.Calculator-j2me-jar.7z здесь]


