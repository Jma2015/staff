#summary Создание C++ клиента StockQuote из WSDL.

<h1>Содержание</h1>
<wiki:toc max_depth="2" />

= Введение =

Этот документ описывает шаги для создания С++ клиента из WSDL.

В качестве сервиса будет использован сервис !StockQuote с http://webservicex.net/ws/WSDetails.aspx?CATID=2&WSID=9 .

= Зависимости =

Должен быть установлен и сконфигурирован WSF Staff как описано в [InstallationManual Инструкции по установке].


= Описание =

== 1. Генерация проекта клиента ==

 # Создайте каталог куда будет помещен клиент !StockQuote;
 # Войдите в этот каталог и запустите генератор кода для создания проекта из WSDL:
{{{
  staff_codegen -pwsdl -tclient_all http://www.webservicex.net/stockquote.asmx?WSDL
}}}
 # Будет сгенерирован следующий набор файлов:
|| *Файл*                      || *Описание*                                      ||
|| stockquote.asmx             || Загруженный файл WSDL                           ||
|| Makefile                    || Makefile для GNU Make                           ||
|| stockquote_client.pro       || Файл проекта Qt (для qmake и Qt-Creator IDE)    ||
|| stockquote_client.vcproj    || Файл проекта для Visual Studio                  ||
|| codegen.cmd                 || Скрипт кодогенерации для VS                     ||
|| src/stockquote.h            || Интерфейс сервиса !StockQuote                   ||
|| src/main.cpp                || Шаблон реализации клиента                       ||


== 2. Реализация клиента ==

Для реализации клиента Вы можете использовать:
  * Microsoft Visual Studio 2005 или выше;
  * Qt-Creator (любая версия);
  * Любой текстовый редактор.

Используйте один из способов ниже:

==== Открытие клиентского проекта в Visual Studio ====

Для открытия проекта в Visual Studio запустите `stockquote_client.vcproj`.

В Solution Explorer откройте файл `main.cpp` находящийся в подпапке "Source Files".


==== Открытие клиентского проекта в Qt-Creator ====

Запустите Qt-Creator, Нажмите кнопку "Open Project..." в режиме "Welcome", либо выберите пункт главного меню "File" => "Open File or Project...".

Перейдите к файлу `stockquote_client.pro` и нажмите "Open".

В открывшемся окне "Project Setup" нажмите "Finish".

В панели "Projects" откройте файл `main.cpp` находящийся в подпапке "Sources/src".


==== Открытие клиентского проекта в любом текстовом редакторе ====

Запустите текстовый редактор и откройте файл `main.cpp` из каталога `src` находящемся в каталоге клиента !StockQuote.


=== Реализация клиента ===

Раскоментируйте исходный код ниже комментария "Invoke Your service here:".

Добавьте строку следом за "`staff::Optional<std::string> symbol`":
{{{
symbol = "IBM";
}}}

Функция main клиента !StockQuote должна выглядеть так:
{{{

int main(int /*nArgs*/, const char* /*paszArgs*/[])
{
  try
  {
    std::auto_ptr< StockQuote > pStockQuote(::staff::ServiceFactory::Inst().GetService< StockQuote >());

    STAFF_ASSERTS(pStockQuote.get(), "Cannot get client for service StockQuote!");

    // Invoke Your service here:

    staff::Optional<std::string> symbol("IBM");
    const std::string& GetQuoteResponse = pStockQuote->GetQuote(symbol);
    staff::LogInfo() << "GetQuote result: " << GetQuoteResponse;
  }
  STAFF_CATCH_ALL

  return 0;
}

}}}


== 3. Компиляция и запуск клиента ==


==== Компиляция и запуск клиента в Visual Studio ====

Выберите из главного меню "Build" => "Configuration Manager...".

В открывшемся окне установите параметр "Active solution configuration" в "Release", если Вы используете версию из секции загрузок. Иначе клиент не будет запущен из-за несовместимости библиотек. Нажмите "Close".

Для компиляции проекта выберите из главного меню "Build" => "Build Solution". Клиент `stockquote_client` теперь должен быть скомпилирован.

|| _*Замечание*: Если Вы получаете ошибку "LINK : fatal error LNK1104: cannot open file '.\release\stockquoteProxy.obj'" (может произойти при первой сборке), запустите процесс сборки снова._ ||

Для запуска клиента выберите из главного меню "Debug" => "Start without debugging...".

Должно появиться консольное окно с результатами выполнения.


==== Компиляция и запуск клиента в Qt-Creator ====

Для компиляции клиента выберите из главного меню "Build" => "Build All".

Для запуска клиента выберите из главного меню "Build" => "Run".


==== Компиляция и запуск клиента с использованием GNU Make ====

Для компиляции клиента введите команду `make` (`gmake` in FreeBSD) из каталога клиента.

Для запуска клиента войдите в каталог `out`, войдите в подкаталог внутри, запустите `stockquote_client`.

