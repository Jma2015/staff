#summary Руководство по установке, конфигурации и тестированию под Linux
#labels Phase-Deploy

= Вступление =

Это руководство по компиляции и установке Staff под ОС Linux.

= Описание =

== 0. Переменные окружения ==
При компиляции, запуске axis2/c, клиентского или сервисного приложения, должны быть установлены следующие переменные окружения:
{{{
export AXIS2C_HOME=/usr/local/axis2c
export STAFF_HOME=/usr/local/staff
export PATH=$PATH:/usr/local/staff/bin
}}}

Вы можете добавить эти строки в конец файла ~/.profile, после чего, либо произвести повторный вход в систему, либо выполнить:
{{{
. ~/.profile
}}}

== 1. Компиляция и установка зависимостей ==

Сначала необходимо установить axis2/c-1.6.0. Домашняя страница Axis2/C: http://ws.apache.org/axis2/c/

Чтобы установть axis2/c Вы можете использовать следующую последовательность комманд:
{{{
mkdir -p ~/devel/axis2c
cd ~/devel/axis2c
wget http://apache.rinet.ru/dist/ws/axis2/c/1_6_0/axis2c-src-1.6.0.tar.gz
tar zxf axis2c-src-1.6.0.tar.gz
cd axis2c-src-1.6.0
# загрузить и применить UTF-8 патч для guththila
wget https://issues.apache.org/jira/secure/attachment/12407627/utf8-patch.txt
patch -d. -p0 <utf8-patch.txt
# конфигурация с guththila
./configure --prefix=$AXIS2C_HOME --enable-tests=no --enable-amqp=no
make && sudo -E make install
# установка примеров
cd samples
CFLAGS=-I$AXIS2C_HOME/include/axis2-1.6.0 LDFLAGS=-L$AXIS2C_HOME/lib ./configure --prefix=$AXIS2C_HOME
make && sudo -E make install
}}}


== 2. Получение исходного кода ==

Пожалуйста перейдите по ссылке http://code.google.com/p/staff/source/checkout для получения информации о том, как загрузить исходный код из svn репозитория.
Или загрузите архив исходных файлов из секции [http://code.google.com/p/staff/downloads/list Download].

== 3. Компиляция исходного кода ==

_Пакет binutils-dev должен быть установлен._

Введите эти команды для компиляции и установки staff из корня рабочей копии (staff-read-only):

{{{
make && sudo -E make install
echo -e "$STAFF_HOME/lib\n$AXIS2C_HOME/lib" | sudo tee /etc/ld.so.conf.d/staff.conf
sudo ldconfig
chmod 777 $AXIS2C_HOME/logs
}}}

Для компиляции и установки примеров запустите:
{{{
cd staff/samples
make && sudo -E make install
}}}

== 4. Запуск ==

=== 4.1 Запуск в обычном режиме ===

Чтобы запустить сервер приложений axis2/c в обычном режиме, введите команды:
{{{
cd $AXIS2C_HOME/bin
./axis2_http_server
}}}

=== 4.2 Запуск в отладочном режиме == 

Чтобы запустить сервер приложений axis2/c в отладочном режиме, введите команды:
{{{
cd $AXIS2C_HOME/bin
STAFF_LOG_LEVEL=DEBUG3 STAFF_EXCEPTION_STACKTRACING=1 ./axis2_http_server
}}}


== 5. Тестирование ==

=== 5.1 Основной тест ===

В Веб-браузере откройте ссылку:

http://localhost:9090/axis2/services

Примеры сервисов "samples.calc.!CalcService", "samples.calc.!SubService" должны быть в списке.


=== 5.2 Тест клиент-сервисного взаимодействия ===

Из другой консоли запустите клиент calc:
{{{
${STAFF_HOME}/samples/bin/calc_client
}}}

На экран должно быть выведено:
{{{
INFO main.cpp[49]: main: 1 + 2 = 3
INFO main.cpp[51]: main: 3 - 1 = 2
INFO main.cpp[53]: main: Saved service mem: 0
INFO main.cpp[58]: main: Setting mem: 46
INFO main.cpp[60]: main: 46
INFO main.cpp[61]: main: Service mem: 46
}}}
